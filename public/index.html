<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LaTeX MCQ Input</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <div class="container">
    <h1>Submit MCQ (LaTeX Supported)</h1>

    <form id="mcqForm" method="POST">

      <label>Question (LaTeX):</label>
      <textarea name="question" id="question" rows="3" oninput="renderLatex()" required></textarea>
  <h3>Preview:</h3>
    <div id="preview"></div>
     <label>Option 1:</label>
<input type="text" name="option1" id="option1" required oninput="renderOptionLatex(1)" />
<div class="option-preview" id="preview-option1"></div>

<label>Option 2:</label>
<input type="text" name="option2" id="option2" required oninput="renderOptionLatex(2)" />
<div class="option-preview" id="preview-option2"></div>

<label>Option 3:</label>
<input type="text" name="option3" id="option3" required oninput="renderOptionLatex(3)" />
<div class="option-preview" id="preview-option3"></div>

<label>Option 4:</label>
<input type="text" name="option4" id="option4" required oninput="renderOptionLatex(4)" />
<div class="option-preview" id="preview-option4"></div>


      <label>Correct Option (1-4):</label>
<input type="number" name="correctOption" min="1" max="4" required>


      <label for="subject">Subject:</label>
      <select name="subject" id="subject" required onchange="updateTopics()">
        <option value="">-- Select Subject --</option>
        <option value="Maths">Maths</option>
        <option value="Physics">Physics</option>
        <option value="Chemistry">Chemistry</option>
      </select>

      <label for="topic">Topic:</label>
      <select name="topic" id="topic" required>
        <option value="">-- Select Topic --</option>
      </select>

      <label for="difficulty">Difficulty:</label>
      <select name="difficulty" id="difficulty" required>
        <option value="">-- Select Difficulty --</option>
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
      </select>

      <button type="submit">Save</button>
      <button type="button" onclick="form.reset(); preview.innerHTML='';">Clear Form</button>
      <div id="successMessage"></div>
    </form>
    <hr />
<h2>Stored Questions</h2>
<button onclick="loadQuestions()">üîç View All Questions</button>
<div id="questionList"></div>

  </div>

  <script>


 
 let previewTimeout;

function renderLatex() {
  clearTimeout(previewTimeout); // Debounce rendering

  previewTimeout = setTimeout(() => {
    const input = document.getElementById('question').value.trim();
    const preview = document.getElementById('preview');

    if (!input) {
      preview.innerHTML = '<em style="color: #777;">Preview will appear here...</em>';
      return;
    }

    // Escape HTML to prevent tag injection
    let escaped = input.replace(/</g, '&lt;').replace(/>/g, '&gt;');

    // Replace $$...$$ with \[...\] (display math) if not already using \[ \]
    escaped = escaped.replace(/\$\$(.+?)\$\$/gs, (_, match) => `\\[${match.trim()}\\]`);

    // Replace $...$ with \(...\) (inline math) if not already using \( \)
    escaped = escaped.replace(/(^|[^\\])\$(.+?)\$/g, (_, prefix, match) => `${prefix}\\(${match.trim()}\\)`);

    // Inject and render using MathJax
    preview.innerHTML = escaped;

    MathJax.typesetClear([preview]);
    MathJax.typesetPromise([preview]).catch(err => {
      preview.innerHTML = '<span style="color:red;">LaTeX rendering error.</span>';
      console.error('MathJax error:', err);
    });
  }, 300);
}
function renderOptionLatex(num) {
  const input = document.getElementById(`option${num}`).value.trim();
  const preview = document.getElementById(`preview-option${num}`);

  if (!input) {
    preview.innerHTML = '<em style="color:#777;">Preview...</em>';
    return;
  }

  let escaped = input.replace(/</g, '&lt;').replace(/>/g, '&gt;');

  // Convert $$...$$ to \[...\]
  escaped = escaped.replace(/\$\$(.+?)\$\$/gs, (_, match) => `\\[${match.trim()}\\]`);
  // Convert $...$ to \(...\)
  escaped = escaped.replace(/(^|[^\\])\$(.+?)\$/g, (_, prefix, match) => `${prefix}\\(${match.trim()}\\)`);

  preview.innerHTML = escaped;

  MathJax.typesetClear([preview]);
  MathJax.typesetPromise([preview]).catch(err => {
    preview.innerHTML = '<span style="color:red;">Rendering error</span>';
    console.error('MathJax error:', err);
  });
}





    function showSuccess() {
      const msg = document.getElementById("successMessage");
      msg.textContent = "‚úÖ Question submitted successfully!";
      msg.style.color = "green";
      setTimeout(() => (msg.textContent = ""), 3000);
      return true;
    }

    const physicsTopics = [ "Physical World and Measurement", "Kinematics", "Laws of Motion", "Work, Energy and Power", "Rotational Motion", "Gravitation", "Properties of Solids and Liquids", "Thermodynamics", "Kinetic Theory of Gases", "Oscillations and Waves", "Electrostatics", "Current Electricity", "Magnetic Effects of Current and Magnetism", "Electromagnetic Induction and Alternating Currents", "Electromagnetic Waves", "Optics", "Dual Nature of Matter and Radiation", "Atoms and Nuclei", "Electronic Devices", "Communication Systems" ];

    const chemistryTopics = [ "Some Basic Concepts of Chemistry (Mole Concept)", "Atomic Structure", "Chemical Bonding and Molecular Structure", "Chemical Thermodynamics", "Solutions", "Equilibrium", "Redox Reactions and Electrochemistry", "Chemical Kinetics", "Surface Chemistry", "Classification of Elements and Periodicity in Properties", "General Principles and Processes of Isolation of Metals", "Hydrogen", "S-block elements (Alkali and Alkaline earth metals)", "P-block elements", "D and F block elements", "Coordination Compounds", "Environmental Chemistry", "Organic Chemistry ‚Äì Basic Principles and Techniques", "Hydrocarbons", "Haloalkanes and Haloarenes", "Alcohols, Phenols, and Ethers", "Aldehydes, Ketones, and Carboxylic Acids", "Organic Compounds Containing Nitrogen", "Polymers", "Biomolecules" ];

    const mathsTopics = [ "Sets, Relations and Functions", "Complex Numbers and Quadratic Equations", "Matrices and Determinants", "Permutations and Combinations", "Mathematical Induction", "Binomial Theorem", "Sequences and Series", "Limits, Continuity and Differentiability", "Integral Calculus", "Differential Equations", "Coordinate Geometry", "3D Geometry", "Vector Algebra", "Statistics and Probability", "Trigonometry", "Mathematical Reasoning" ];

    function updateTopics() {
      const subject = document.getElementById("subject").value;
      const topicSelect = document.getElementById("topic");
      topicSelect.innerHTML = "";

      let topics = [];
      if (subject === "Physics") topics = physicsTopics;
      else if (subject === "Chemistry") topics = chemistryTopics;
      else if (subject === "Maths") topics = mathsTopics;

      const defaultOption = document.createElement("option");
      defaultOption.value = "";
      defaultOption.textContent = "-- Select Topic --";
      topicSelect.appendChild(defaultOption);

      topics.forEach((topic) => {
        const option = document.createElement("option");
        option.value = topic;
        option.textContent = topic;
        topicSelect.appendChild(option);
      });
    }
    
  const form = document.getElementById('mcqForm');

  form.addEventListener('submit', async function(event) {
    event.preventDefault(); // Prevent normal form submission

    const formData = new FormData(form);
    const data = {
      question: formData.get('question'),
      options: [
        formData.get('option1'),
        formData.get('option2'),
        formData.get('option3'),
        formData.get('option4')
      ],
      correctOption: formData.get('correctOption'),
      subject: formData.get('subject'),
      topic: formData.get('topic'),
      difficulty: formData.get('difficulty'),
    };

    try {
      const response = await fetch('/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      if (response.ok) {
        alert('Question added successfully!');
        form.reset();
        document.getElementById('preview').innerHTML = '';
      } else {
        alert('Failed to add question.');
      }
    } catch (error) {
      alert('Error: ' + error.message);
    }
  });
// change
async function loadQuestions() {
  const response = await fetch('/questions');
  const questions = await response.json();

  const list = document.getElementById('questionList');
  list.innerHTML = '';

  if (questions.length === 0) {
    list.innerHTML = '<p>No questions found.</p>';
    return;
  }

  questions.forEach((q, i) => {
    const div = document.createElement('div');
    div.className = 'question-card';
    div.innerHTML = `
      <strong>Q${i + 1}:</strong> ${q.question}<br/>
      <ul>
        ${q.options.map((opt, idx) => `
          <li${idx === q.correctOption ? ' style="font-weight:bold;color:green;"' : ''}>${String.fromCharCode(65 + idx)}. ${opt}</li>`).join('')}
      </ul>
      <em>Subject:</em> ${q.subject}, <em>Topic:</em> ${q.topic}, <em>Difficulty:</em> ${q.difficulty}
      <hr/>
    `;
    list.appendChild(div);
  });

  MathJax.typesetPromise([list]); // Render LaTeX
}


  </script>
</body>
</html>






